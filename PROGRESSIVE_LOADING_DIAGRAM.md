# Progressive Flight Search - Visual Flow Diagram

## System Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           USER INTERFACE                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  Flight Search Page (flight-stream/[origin]/[destination]) â”‚    â”‚
â”‚  â”‚                                                             â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚    â”‚
â”‚  â”‚  â”‚  Progress Bar: [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘] 80%          â”‚             â”‚    â”‚
â”‚  â”‚  â”‚  alibaba âœ“ | mrbilit âœ“ | safar366 â³    â”‚             â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚    â”‚
â”‚  â”‚                                                             â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚    â”‚
â”‚  â”‚  â”‚  Flight Card 1  [NEW!]                   â”‚ â† Animation â”‚    â”‚
â”‚  â”‚  â”‚  THR â†’ MHD | 3 Ù…Ù†Ø¨Ø¹ | 2,500,000 ØªÙˆÙ…Ø§Ù†   â”‚             â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚    â”‚
â”‚  â”‚                                                             â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚    â”‚
â”‚  â”‚  â”‚  Flight Card 2  [UPDATED!]               â”‚ â† Glow!    â”‚    â”‚
â”‚  â”‚  â”‚  THR â†’ MHD | 4 Ù…Ù†Ø¨Ø¹ | 2,300,000 ØªÙˆÙ…Ø§Ù†   â”‚             â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚    â”‚
â”‚  â”‚                                                             â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                              â†‘                                       â”‚
â”‚                              â”‚ SSE Events (Real-time)                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     BACKEND (NestJS)                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  FlightsStreamController                                   â”‚    â”‚
â”‚  â”‚  GET /flights/search-stream?origin=THR&destination=MHD     â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                       â”‚                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  FlightStreamService                                        â”‚    â”‚
â”‚  â”‚  â€¢ Manages SSE connection                                   â”‚    â”‚
â”‚  â”‚  â€¢ Queries providers sequentially                           â”‚    â”‚
â”‚  â”‚  â€¢ Converts & groups flights                                â”‚    â”‚
â”‚  â”‚  â€¢ Emits events progressively                               â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                       â”‚                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  ScraperHttpService                                         â”‚    â”‚
â”‚  â”‚  â€¢ queryUnifiedProvider(provider)                           â”‚    â”‚
â”‚  â”‚  â€¢ Normalizes flight data                                   â”‚    â”‚
â”‚  â”‚  â€¢ Filters invalid flights                                  â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                       â”‚                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚ HTTP Requests (parallel/sequential)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                SCRAPER SERVICE (Python FastAPI)                     â”‚
â”‚                       â”‚                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  Unified Provider Endpoints                                 â”‚    â”‚
â”‚  â”‚  /unified/alibaba                                           â”‚    â”‚
â”‚  â”‚  /unified/mrbilit                                           â”‚    â”‚
â”‚  â”‚  /unified/safar366                                          â”‚    â”‚
â”‚  â”‚  /unified/safarmarket                                       â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                       â”‚                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  Individual Scrapers                                        â”‚    â”‚
â”‚  â”‚  alibaba.py | mrbilit.py | safar366.py | safarmarket.py   â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  Provider APIs           â”‚
        â”‚  â€¢ Alibaba Travel        â”‚
        â”‚  â€¢ MrBilit               â”‚
        â”‚  â€¢ Safar366              â”‚
        â”‚  â€¢ SafarMarket           â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Timing Diagram (Progressive Loading)

```
TIME â†’  0s        3s        6s       10s       15s
        â”‚         â”‚         â”‚         â”‚         â”‚
User    â”‚         â”‚         â”‚         â”‚         â”‚
Search  â—â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
        â”‚         â”‚         â”‚         â”‚         â”‚
        â”‚         â”‚         â”‚         â”‚         â”‚
Backend â”‚ Start   â”‚         â”‚         â”‚         â”‚ Complete
Query   â”‚ Stream  â”‚         â”‚         â”‚         â”‚ Stream
        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
        â”‚         â”‚         â”‚         â”‚         â”‚
Providerâ”‚ Query   â”‚ Query   â”‚ Query   â”‚ Query   â”‚
Queries â”‚ alibaba â”‚ mrbilit â”‚ safar366â”‚ safar-  â”‚
        â”‚         â”‚         â”‚         â”‚ market  â”‚
        â”‚    â†“    â”‚    â†“    â”‚    â†“    â”‚    â†“    â”‚
        â”‚   30    â”‚   25    â”‚   18    â”‚   22    â”‚
Results â”‚ flights â”‚ flights â”‚ flights â”‚ flights â”‚
Sent    â”‚         â”‚         â”‚         â”‚         â”‚
        â”‚         â”‚         â”‚         â”‚         â”‚
        â”‚         â”‚         â”‚         â”‚         â”‚
User    â”‚ Loading â”‚ 30      â”‚ 55      â”‚ 73      â”‚ 95
Sees    â”‚ ...     â”‚ flights â”‚ flights â”‚ flights â”‚ flights
        â”‚         â”‚ âœ¨      â”‚ âœ¨      â”‚ âœ¨      â”‚ âœ¨
        â”‚         â”‚ Can     â”‚ More    â”‚ Even    â”‚ Complete
        â”‚         â”‚ Browse! â”‚ options!â”‚ more!   â”‚ âœ…
```

## Event Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  EVENT SEQUENCE                                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                   â”‚
â”‚  1ï¸âƒ£  START SEARCH                                                â”‚
â”‚     EventSource connects to /flights/search-stream               â”‚
â”‚                                                                   â”‚
â”‚  2ï¸âƒ£  PROGRESS EVENT (0/4 complete)                              â”‚
â”‚     { type: 'progress', completed: 0, total: 4 }                â”‚
â”‚                                                                   â”‚
â”‚  3ï¸âƒ£  PROVIDER_RESULT EVENT (alibaba)                            â”‚
â”‚     {                                                             â”‚
â”‚       type: 'provider_result',                                   â”‚
â”‚       provider: 'alibaba',                                       â”‚
â”‚       flights: [30 flights],                                     â”‚
â”‚       metadata: { scrape_time: 2.3s }                           â”‚
â”‚     }                                                             â”‚
â”‚     â†’ Frontend displays 30 flights with slide-in animation       â”‚
â”‚                                                                   â”‚
â”‚  4ï¸âƒ£  PROGRESS EVENT (1/4 complete)                              â”‚
â”‚     { type: 'progress', completed: 1, total: 4 }                â”‚
â”‚                                                                   â”‚
â”‚  5ï¸âƒ£  PROVIDER_RESULT EVENT (mrbilit)                            â”‚
â”‚     {                                                             â”‚
â”‚       type: 'provider_result',                                   â”‚
â”‚       provider: 'mrbilit',                                       â”‚
â”‚       flights: [25 flights],                                     â”‚
â”‚       metadata: { scrape_time: 3.1s }                           â”‚
â”‚     }                                                             â”‚
â”‚     â†’ Frontend merges flights, updates existing + adds new       â”‚
â”‚     â†’ Updated flights show glow animation                        â”‚
â”‚                                                                   â”‚
â”‚  6ï¸âƒ£  PROGRESS EVENT (2/4 complete)                              â”‚
â”‚                                                                   â”‚
â”‚  7ï¸âƒ£  PROVIDER_RESULT EVENT (safar366) - Same pattern            â”‚
â”‚                                                                   â”‚
â”‚  8ï¸âƒ£  PROGRESS EVENT (3/4 complete)                              â”‚
â”‚                                                                   â”‚
â”‚  9ï¸âƒ£  PROVIDER_RESULT EVENT (safarmarket) - Same pattern         â”‚
â”‚                                                                   â”‚
â”‚  ğŸ”Ÿ  PROGRESS EVENT (4/4 complete)                              â”‚
â”‚                                                                   â”‚
â”‚  1ï¸âƒ£1ï¸âƒ£  SEARCH_COMPLETE EVENT                                    â”‚
â”‚     {                                                             â”‚
â”‚       type: 'search_complete',                                   â”‚
â”‚       metadata: {                                                 â”‚
â”‚         total_providers: 4,                                      â”‚
â”‚         successful: 4,                                            â”‚
â”‚         failed: 0,                                                â”‚
â”‚         total_time_ms: 14523                                     â”‚
â”‚       }                                                           â”‚
â”‚     }                                                             â”‚
â”‚     â†’ Frontend hides loading indicator                           â”‚
â”‚     â†’ Shows completion message                                   â”‚
â”‚                                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Flight Merging Logic

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  FLIGHT MERGING EXAMPLE                                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                   â”‚
â”‚  Initial State (from alibaba):                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ base_flight_id: "THR-MHD-2025-12-20-W5-1057-0800"       â”‚    â”‚
â”‚  â”‚ flight_number: "W5-1057"                                 â”‚    â”‚
â”‚  â”‚ airline: "Ù…Ø§Ù‡Ø§Ù†"                                         â”‚    â”‚
â”‚  â”‚ lowestPrice: 2,500,000                                   â”‚    â”‚
â”‚  â”‚ highestPrice: 2,500,000                                  â”‚    â”‚
â”‚  â”‚ availableProviders: 1                                    â”‚    â”‚
â”‚  â”‚ pricingOptions: [                                        â”‚    â”‚
â”‚  â”‚   { provider: "alibaba", price: 2,500,000 }             â”‚    â”‚
â”‚  â”‚ ]                                                         â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                   â”‚
â”‚  â†“ mrbilit finds same flight with different price                â”‚
â”‚                                                                   â”‚
â”‚  Merged State:                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ base_flight_id: "THR-MHD-2025-12-20-W5-1057-0800"       â”‚    â”‚
â”‚  â”‚ flight_number: "W5-1057"                                 â”‚    â”‚
â”‚  â”‚ airline: "Ù…Ø§Ù‡Ø§Ù†"                                         â”‚    â”‚
â”‚  â”‚ lowestPrice: 2,300,000  â† Updated!                      â”‚    â”‚
â”‚  â”‚ highestPrice: 2,500,000                                  â”‚    â”‚
â”‚  â”‚ availableProviders: 2   â† Updated!                      â”‚    â”‚
â”‚  â”‚ pricingOptions: [                                        â”‚    â”‚
â”‚  â”‚   { provider: "alibaba", price: 2,500,000 },            â”‚    â”‚
â”‚  â”‚   { provider: "mrbilit", price: 2,300,000 }  â† Added!   â”‚    â”‚
â”‚  â”‚ ]                                                         â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                   â”‚
â”‚  â†’ UI shows glow animation on this card                          â”‚
â”‚  â†’ "2 Ù…Ù†Ø¨Ø¹" badge updates with animation                        â”‚
â”‚  â†’ Price updates with highlight                                  â”‚
â”‚                                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Component Hierarchy

```
StreamingFlightSearch (Page)
â”‚
â”œâ”€ Header
â”‚  â””â”€ Search Form Link
â”‚
â”œâ”€ DateHeader
â”‚  â””â”€ Date Selection
â”‚
â”œâ”€ Progress Bar (when loading)
â”‚  â”œâ”€ Progress percentage
â”‚  â””â”€ Provider status badges
â”‚     â”œâ”€ alibaba âœ“
â”‚     â”œâ”€ mrbilit âœ“
â”‚     â”œâ”€ safar366 â³
â”‚     â””â”€ safarmarket âŠ˜
â”‚
â”œâ”€ Results Summary
â”‚  â”œâ”€ Total flights count
â”‚  â”œâ”€ Total options count
â”‚  â””â”€ Search time
â”‚
â”œâ”€ Filter & Sort Bar
â”‚  â”œâ”€ Sort dropdown (price/time/duration)
â”‚  â”œâ”€ Provider filter
â”‚  â””â”€ Airline filter
â”‚
â””â”€ Flight List
   â”œâ”€ AnimatedFlightCard (flight 1) [NEW!]
   â”‚  â”œâ”€ Airline icon & name
   â”‚  â”œâ”€ Provider badge
   â”‚  â”œâ”€ Route & schedule
   â”‚  â”œâ”€ Price & options
   â”‚  â””â”€ Book button
   â”‚
   â”œâ”€ AnimatedFlightCard (flight 2) [UPDATED!]
   â”‚  â””â”€ ... (same structure)
   â”‚
   â””â”€ ... (more flights)
```

## State Management Flow

```
useStreamingFlights Hook
â”‚
â”œâ”€ useState: flights[]
â”‚  â””â”€ Updated on each provider_result event
â”‚
â”œâ”€ useState: metadata
â”‚  â””â”€ Updated on search_complete event
â”‚
â”œâ”€ useState: isLoading
â”‚  â””â”€ true â†’ false on search_complete
â”‚
â”œâ”€ useState: providerProgress[]
â”‚  â””â”€ Updated on each progress event
â”‚
â”œâ”€ useRef: flightsMapRef
â”‚  â””â”€ Efficient O(1) lookup for merging
â”‚
â”œâ”€ useRef: eventSourceRef
â”‚  â””â”€ Maintains SSE connection
â”‚
â””â”€ useCallback: mergeFlights()
   â””â”€ Smart deduplication logic
```

## Animation Timeline

```
New Flight Animation:
â”‚
0ms  â”€â”€â”€ opacity: 0, translateY: 20px
â”‚        (invisible, below position)
â”‚
â”‚        CSS: .animate-slide-in-up
â”‚
500ms â”€â”€ opacity: 1, translateY: 0
         (visible, in position)
         timing: ease-out

Update Animation:
â”‚
0ms  â”€â”€â”€ box-shadow: 0 0 0 0 rgba(accent, 0.4)
â”‚        (no glow)
â”‚
â”‚        CSS: .animate-pulse-glow
â”‚
400ms â”€â”€ box-shadow: 0 0 20px 5px rgba(accent, 0.6)
â”‚        (maximum glow)
â”‚
800ms â”€â”€ box-shadow: 0 0 0 0 rgba(accent, 0.4)
         (back to no glow)
         timing: ease-in-out
```

---

**Visual Summary:**
- ğŸ¯ User searches â†’ Progressive results stream in
- âœ¨ Smooth animations for new/updated flights
- ğŸ“Š Real-time progress tracking
- ğŸ”„ Smart merging of duplicate flights
- âš¡ 5-10x faster perceived performance
